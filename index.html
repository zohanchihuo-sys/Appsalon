<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mi Salón PRO (2 personas)</title>
  <style>
    :root{
      --bg:#0b0b0f;
      --card:#141422;
      --card2:#10101a;
      --text:#f2f2f7;
      --muted:#b8b8c7;
      --gold:#d4af37;
      --bad:#ff5a67;
      --ok:#33d17a;
      --line:rgba(255,255,255,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
      --radius2:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;
      background: radial-gradient(1200px 800px at 20% -20%, rgba(212,175,55,.18), transparent 55%),
                  radial-gradient(900px 700px at 120% 10%, rgba(120,70,255,.15), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(10px);
      background: rgba(11,11,15,.7);
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:980px; margin:0 auto; padding:16px}
    .top{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding:10px 0;
    }
    .brand{display:flex; align-items:center; gap:10px}
    .logo{
      width:40px; height:40px; border-radius:14px;
      background: linear-gradient(135deg, rgba(212,175,55,.9), rgba(212,175,55,.2));
      box-shadow: 0 12px 30px rgba(212,175,55,.15);
      display:grid; place-items:center;
      color:#0b0b0f; font-weight:900;
    }
    .brand h1{font-size:16px; margin:0}
    .brand p{margin:0; font-size:12px; color:var(--muted)}
    .tabs{display:flex; gap:8px; flex-wrap:wrap; padding:10px 0 14px}
    .tab{
      border:1px solid var(--line);
      background: rgba(20,20,34,.65);
      color:var(--muted);
      padding:10px 12px;
      border-radius:999px;
      cursor:pointer;
      user-select:none;
      transition:.2s transform, .2s background, .2s color, .2s border;
      font-size:13px;
    }
    .tab.active{
      background: rgba(212,175,55,.18);
      border-color: rgba(212,175,55,.45);
      color:var(--text);
      transform: translateY(-1px);
    }
    main{padding:18px 0 32px}
    .grid{display:grid; grid-template-columns: 1.15fr .85fr; gap:14px}
    @media (max-width: 860px){ .grid{grid-template-columns:1fr} }
    .card{
      background: linear-gradient(180deg, rgba(20,20,34,.9), rgba(16,16,26,.92));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .card .hd h2{margin:0; font-size:14px}
    .card .hd .hint{font-size:12px; color:var(--muted)}
    .card .bd{padding:14px}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .col{flex:1; min-width:180px}
    label{display:block; font-size:12px; color:var(--muted); margin:0 0 6px}
    input, select, textarea{
      width:100%;
      padding:11px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.05);
      border:1px solid var(--line);
      color:var(--text);
      outline:none;
    }
    textarea{min-height:86px; resize:vertical}
    input::placeholder, textarea::placeholder{color:rgba(242,242,247,.45)}
    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    button{
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding:11px 12px;
      border-radius: 999px;
      cursor:pointer;
      transition:.18s transform, .18s opacity, .18s background, .18s border;
      font-size:13px;
    }
    button:hover{transform: translateY(-1px)}
    button:active{transform: translateY(0px); opacity:.9}
    .primary{ background: rgba(212,175,55,.18); border-color: rgba(212,175,55,.45) }
    .danger{ background: rgba(255,90,103,.12); border-color: rgba(255,90,103,.35) }
    .ok{ background: rgba(51,209,122,.12); border-color: rgba(51,209,122,.35) }
    .muted{color:var(--muted)}
    .pill{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color:var(--muted);
      white-space:nowrap;
    }
    .list{display:flex; flex-direction:column; gap:10px}
    .item{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      border-radius: var(--radius2);
      padding:12px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .item h3{ margin:0 0 4px; font-size:13px; }
    .item p{ margin:0; font-size:12px; color:var(--muted); line-height:1.35; }
    .item .meta{ display:flex; gap:6px; flex-wrap:wrap; margin-top:8px; }
    .actions{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end}
    .mini{ padding:8px 10px; font-size:12px; border-radius:999px; }
    .kpis{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin-bottom:12px;
    }
    @media (max-width: 520px){ .kpis{grid-template-columns:1fr} }
    .kpi{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      border-radius: var(--radius2);
      padding:12px;
    }
    .kpi .v{font-size:18px; font-weight:800}
    .kpi .t{font-size:12px; color:var(--muted)}
    .sep{height:1px; background:var(--line); margin:12px 0}
    .note{font-size:12px; color:var(--muted); line-height:1.4}
    .hidden{display:none !important}
    .right{display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end}
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo">★</div>
        <div>
          <h1>Mi Salón PRO</h1>
          <p>2 personas · Offline · WhatsApp · Caja</p>
        </div>
      </div>
      <div class="right">
        <span class="pill" id="pillStatus">Guardado: OK</span>
        <button class="mini" onclick="exportarJSON()">Exportar</button>
        <button class="mini" onclick="importarJSON()">Importar</button>
        <button class="mini danger" onclick="resetTotal()">Reset</button>
      </div>
    </div>

    <div class="tabs" id="tabs">
      <div class="tab active" data-tab="inicio">Inicio</div>
      <div class="tab" data-tab="agenda">Agenda</div>
      <div class="tab" data-tab="clientes">Clientes</div>
      <div class="tab" data-tab="servicios">Servicios</div>
      <div class="tab" data-tab="caja">Caja</div>
      <div class="tab" data-tab="ajustes">Ajustes</div>
    </div>
  </div>
</header>

<main class="wrap">
  <!-- INICIO -->
  <section id="tab-inicio">
    <div class="grid">
      <div class="card">
        <div class="hd">
          <h2>Hoy</h2>
          <div class="hint" id="hoyFecha"></div>
        </div>
        <div class="bd">
          <div class="kpis">
            <div class="kpi">
              <div class="v" id="kpiCitas">0</div>
              <div class="t">Citas</div>
            </div>
            <div class="kpi">
              <div class="v" id="kpiIngresos">$0</div>
              <div class="t">Ingresos</div>
            </div>
            <div class="kpi">
              <div class="v" id="kpiGastos">$0</div>
              <div class="t">Gastos</div>
            </div>
          </div>

          <div class="sep"></div>

          <div class="row">
            <div class="col">
              <label>Filtrar por estilista</label>
              <select id="homeFilterPersona" onchange="renderTodo()">
                <option value="">Todas</option>
              </select>
            </div>
            <div class="col">
              <label>Acción rápida</label>
              <button class="primary" onclick="irTab('agenda')">+ Nueva cita</button>
            </div>
          </div>

          <div class="sep"></div>

          <div class="note">
            Tip PRO: antes de pegar cambios grandes, exporta el JSON (backup).
          </div>
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <h2>Próximas citas</h2>
          <div class="hint">Hoy</div>
        </div>
        <div class="bd">
          <div class="list" id="homeCitasList"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- AGENDA -->
  <section id="tab-agenda" class="hidden">
    <div class="grid">
      <div class="card">
        <div class="hd">
          <h2>Nueva cita</h2>
          <div class="hint">Guarda offline</div>
        </div>
        <div class="bd">
          <div class="row">
            <div class="col">
              <label>Fecha</label>
              <input type="date" id="citaFecha" />
            </div>
            <div class="col">
              <label>Hora</label>
              <input type="time" id="citaHora" />
            </div>
            <div class="col">
              <label>Estilista</label>
              <select id="citaPersona"></select>
            </div>
          </div>

          <div class="row" style="margin-top:10px">
            <div class="col">
              <label>Cliente</label>
              <select id="citaCliente"></select>
            </div>
            <div class="col">
              <label>Servicio</label>
              <select id="citaServicio"></select>
            </div>
            <div class="col">
              <label>Precio (MXN)</label>
              <input type="number" id="citaPrecio" placeholder="Ej. 200" />
            </div>
          </div>

          <div class="row" style="margin-top:10px">
            <div class="col">
              <label>Notas</label>
              <textarea id="citaNotas" placeholder="Ej. #2 laterales, tijera arriba, tono, etc."></textarea>
            </div>
          </div>

          <div class="btns">
            <button class="primary" onclick="crearCita()">Guardar cita</button>
            <button onclick="limpiarCita()">Limpiar notas</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <h2>Lista de citas</h2>
          <div class="hint">Filtra y marca atendidas</div>
        </div>
        <div class="bd">
          <div class="row">
            <div class="col">
              <label>Fecha a ver</label>
              <input type="date" id="agendaFiltroFecha" onchange="renderCitas()" />
            </div>
            <div class="col">
              <label>Estilista</label>
              <select id="agendaFiltroPersona" onchange="renderCitas()">
                <option value="">Todas</option>
              </select>
            </div>
          </div>
          <div class="sep"></div>
          <div class="list" id="citasList"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- CLIENTES -->
  <section id="tab-clientes" class="hidden">
    <div class="grid">
      <div class="card">
        <div class="hd">
          <h2>Nuevo cliente</h2>
          <div class="hint">WhatsApp directo</div>
        </div>
        <div class="bd">
          <div class="row">
            <div class="col">
              <label>Nombre</label>
              <input id="cliNombre" placeholder="Ej. Juan Pérez" />
            </div>
            <div class="col">
              <label>WhatsApp (10 dígitos)</label>
              <input id="cliWhats" placeholder="Ej. 9991234567" inputmode="numeric" />
            </div>
          </div>
          <div class="row" style="margin-top:10px">
            <div class="col">
              <label>Notas / Preferencias</label>
              <textarea id="cliNotas" placeholder="Ej. alérgico, color, máquina, etc."></textarea>
            </div>
          </div>
          <div class="btns">
            <button class="primary" onclick="crearCliente()">Guardar cliente</button>
            <button onclick="limpiarCliente()">Limpiar</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <h2>Clientes</h2>
          <div class="hint">Buscar + Editar</div>
        </div>
        <div class="bd">
          <div class="row">
            <div class="col">
              <label>Buscar</label>
              <input id="cliBuscar" placeholder="Escribe nombre..." oninput="renderClientes()" />
            </div>
          </div>
          <div class="sep"></div>
          <div class="list" id="clientesList"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- SERVICIOS -->
  <section id="tab-servicios" class="hidden">
    <div class="grid">
      <div class="card">
        <div class="hd">
          <h2>Nuevo servicio</h2>
          <div class="hint">Editable después</div>
        </div>
        <div class="bd">
          <div class="row">
            <div class="col">
              <label>Nombre</label>
              <input id="srvNombre" placeholder="Ej. Corte" />
            </div>
            <div class="col">
              <label>Duración (min)</label>
              <input id="srvDur" type="number" placeholder="Ej. 30" />
            </div>
            <div class="col">
              <label>Precio (MXN)</label>
              <input id="srvPrecio" type="number" placeholder="Ej. 200" />
            </div>
          </div>
          <div class="btns">
            <button class="primary" onclick="crearServicio()">Guardar servicio</button>
            <button onclick="limpiarServicio()">Limpiar</button>
          </div>
          <div class="note" style="margin-top:10px">
            Tip: en Agenda, al elegir servicio, el precio se autollenará (pero lo puedes cambiar).
          </div>
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <h2>Servicios</h2>
          <div class="hint">Editar nombre / precio</div>
        </div>
        <div class="bd">
          <div class="list" id="serviciosList"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- CAJA -->
  <section id="tab-caja" class="hidden">
    <div class="grid">
      <div class="card">
        <div class="hd">
          <h2>Movimiento</h2>
          <div class="hint">Ingreso / Gasto</div>
        </div>
        <div class="bd">
          <div class="row">
            <div class="col">
              <label>Fecha</label>
              <input type="date" id="movFecha" />
            </div>
            <div class="col">
              <label>Tipo</label>
              <select id="movTipo">
                <option value="ingreso">Ingreso</option>
                <option value="gasto">Gasto</option>
              </select>
            </div>
            <div class="col">
              <label>Monto (MXN)</label>
              <input type="number" id="movMonto" placeholder="Ej. 150" />
            </div>
          </div>

          <div class="row" style="margin-top:10px">
            <div class="col">
              <label>Nota</label>
              <input id="movNota" placeholder="Ej. Venta / Producto / Agua..." />
            </div>
          </div>

          <div class="btns">
            <button class="primary" onclick="crearMovimiento()">Guardar</button>
            <button onclick="limpiarMovimiento()">Limpiar</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <h2>Caja</h2>
          <div class="hint">Por día</div>
        </div>
        <div class="bd">
          <div class="row">
            <div class="col">
              <label>Ver fecha</label>
              <input type="date" id="cajaFiltroFecha" onchange="renderCaja()" />
            </div>
            <div class="col">
              <label>Acción</label>
              <button class="mini" onclick="copiarResumenCaja()">Copiar resumen</button>
            </div>
          </div>
          <div class="sep"></div>
          <div class="kpis">
            <div class="kpi">
              <div class="v" id="cajaIng">$0</div>
              <div class="t">Ingresos</div>
            </div>
            <div class="kpi">
              <div class="v" id="cajaGas">$0</div>
              <div class="t">Gastos</div>
            </div>
            <div class="kpi">
              <div class="v" id="cajaNet">$0</div>
              <div class="t">Neto</div>
            </div>
          </div>
          <div class="sep"></div>
          <div class="list" id="movList"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- AJUSTES -->
  <section id="tab-ajustes" class="hidden">
    <div class="card">
      <div class="hd">
        <h2>Ajustes</h2>
        <div class="hint">Cambia Oz y Kari cuando quieras</div>
      </div>
      <div class="bd">
        <div class="row">
          <div class="col">
            <label>Estilista 1</label>
            <input id="setP1" placeholder="Ej. Oz" />
          </div>
          <div class="col">
            <label>Estilista 2</label>
            <input id="setP2" placeholder="Ej. Kari" />
          </div>
        </div>
        <div class="btns">
          <button class="primary" onclick="guardarAjustes()">Guardar ajustes</button>
          <button onclick="cargarDemo()">Cargar demo</button>
        </div>
        <div class="sep"></div>
        <div class="note">
          <b>Exportar</b> crea un backup JSON.<br/>
          <b>Importar</b> restaura un backup JSON.<br/>
          <b>Reset</b> borra TODO (solo si vas a iniciar desde cero).
        </div>
      </div>
    </div>
  </section>
</main>

<script>
  // =========================
  //  UTILIDADES
  // =========================
  const $ = (id) => document.getElementById(id);
  const money = (n) => {
    const x = Number(n || 0);
    return x.toLocaleString("es-MX", { style:"currency", currency:"MXN" });
  };
  const todayISO = () => new Date().toISOString().slice(0,10);
  const uid = () => String(Date.now()) + "-" + Math.random().toString(16).slice(2);

  // =========================
  //  ESTADO (LocalStorage)
  // =========================
  const KEY = "miSalonPro_v2";

  const defaults = {
    // ✅ Oz y Kari por defecto (pero se puede cambiar en Ajustes)
    settings: { p1:"Oz", p2:"Kari" },

    clientes: [],

    // ✅ Servicios precargados (editables)
    servicios: [
      { id: uid(), nombre:"Corte Caballero", dur:30, precio:200 },
      { id: uid(), nombre:"Corte Dama",      dur:45, precio:250 },
      { id: uid(), nombre:"Corte Niño",      dur:25, precio:180 },
      { id: uid(), nombre:"Planchado",       dur:60, precio:300 },
      { id: uid(), nombre:"Secado de Cabello",dur:30, precio:200 },
      { id: uid(), nombre:"Tinte",           dur:120,precio:700 },
    ],

    citas: [],
    movimientos: []
  };

  let state = load();

  function load(){
    try{
      const raw = localStorage.getItem(KEY);
      if(!raw) return structuredClone(defaults);
      const parsed = JSON.parse(raw);
      return { ...structuredClone(defaults), ...parsed };
    }catch(e){
      return structuredClone(defaults);
    }
  }

  function save(){
    localStorage.setItem(KEY, JSON.stringify(state));
    $("pillStatus").textContent = "Guardado: OK";
    $("pillStatus").style.borderColor = "rgba(51,209,122,.35)";
    $("pillStatus").style.background = "rgba(51,209,122,.12)";
    $("pillStatus").style.color = "var(--text)";
  }

  function flashSave(){
    $("pillStatus").textContent = "Guardando...";
    $("pillStatus").style.borderColor = "rgba(212,175,55,.45)";
    $("pillStatus").style.background = "rgba(212,175,55,.18)";
    $("pillStatus").style.color = "var(--text)";
    setTimeout(save, 80);
  }

  // =========================
  //  TABS
  // =========================
  const tabs = $("tabs");
  tabs.addEventListener("click", (e)=>{
    const t = e.target.closest(".tab");
    if(!t) return;
    irTab(t.dataset.tab);
  });

  function irTab(name){
    document.querySelectorAll(".tab").forEach(x=>x.classList.re
